<!--
  ~    Copyright 2017 OICR
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->
<div *ngIf="(isNFL$ | async) && dagType === 'classic'">
  <span class="alert alert-warning col-md-12" role="alert">
    <mat-icon>warning</mat-icon>&nbsp;DAG display is still experimental for Nextflow.
  </span>
</div>

<div id="dag-holder" [ngClass]="{'fullscreen': expanded}">
  <div id="dag-col" [ngClass]="{'fullscreen-element': expanded}">
    <div [ngClass]="{'fullscreen-dropdown': expanded}" *ngIf="selectedVersion?.valid">
      <div *ngIf="enableCwlViewer && (descriptorType$ | async) === ToolDescriptor.TypeEnum.CWL && (workflow$ | async)?.source_control_provider === 'GITHUB'" style="line-height: 20px;">
        <label class="radio-inline">
          <input type="radio" name="dagType" [(ngModel)]="dagType" value="classic">Classic
        </label>
        <label class="radio-inline">
          <input type="radio" name="dagType" [(ngModel)]="dagType" value="cwlviewer">Common Workflow Language Viewer
        </label>
      </div>
      <div>
        <a *ngIf="dagType === 'classic' && (dagResult$ | async)" href #exportLink id="exportLink" (click)="download()">
          <span class="glyphicon glyphicon-export"></span>Export to PNG</a>
        <!-- This following div is shared by both viewers -->
        <div class="btn-group pull-right" role="group" style="width:auto">
          <button id="dag_fullscreen" (click)="toggleExpand()" matTooltip="Toggle fullscreen" class="dag-button btn btn-default">
            <span *ngIf="!expanded" class="glyphicon glyphicon-resize-full" id="resize-full-button"></span>
            <span  *ngIf="expanded" class="glyphicon glyphicon-resize-small" id="resize-small-button"></span>
          </button>
          <button id="dag_reload" (click)="reset()" class="dag-button btn btn-default" matTooltip="Reset">
            <span class="glyphicon glyphicon-screenshot"></span>
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="dagType === 'classic' && !(isNFL$ | async)">
      <div class="alert alert-warning" role="alert" *ngIf="!(dagResult$ | async) && !selectedVersion?.valid">
        <mat-icon>warning</mat-icon>&nbsp;
        <span *ngIf="(descriptorType$ | async) === ToolDescriptor.TypeEnum.WDL">
          A Descriptor associated with this workflow could not be found.
        </span>
        <span *ngIf="(descriptorType$ | async) === ToolDescriptor.TypeEnum.CWL">
          Please ensure that the Descriptor is a valid CWL 1.0 workflow.
        </span>
      </div>

      <div class="alert alert-warning" role="alert" *ngIf="(descriptorType$ | async) === ToolDescriptor.TypeEnum.CWL && (missingTool$ | async) && selectedVersion?.valid">
        <mat-icon>warning</mat-icon>&nbsp; DAG cannot be created because some required tools
        are missing from Github repo.
      </div>
    </div>

    <app-cwl-viewer *ngIf="enableCwlViewer && (descriptorType$ | async) === ToolDescriptor.TypeEnum.CWL && (workflow$ | async)?.source_control_provider === 'GITHUB'" [hidden]="dagType !== 'cwlviewer'"
                    [workflow]="(workflow$ | async)" [selectedVersion]="selectedVersion" [refresh]="refreshCounter" [expanded]="expanded">
    </app-cwl-viewer>

    <div #cy id="cy" *ngIf="(dagResult$ | async) && !(missingTool$ | async)" [hidden]="dagType !== 'classic'" [ngClass]="{'fullscreen-element large-dag': expanded}" class="mini-dag"></div>
  </div>
</div>
