<div>
  <h4 mat-dialog-title>
    {{ title }}: <span style="color: #3f51b5">Version {{ version.name }}</span>
  </h4>
  <div [ngSwitch]="action">
    <div *ngSwitchCase="SnapshotExporterAction.SNAPSHOT">
      <ng-template *ngTemplateOutlet="snapshotBlurb"></ng-template>
      <div>
        <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px">
          <button color="primary" mat-flat-button (click)="snapshot()">Snapshot</button>
          <button mat-button mat-dialog-close color="secondary">Cancel</button>
        </div>
      </div>
    </div>

    <div *ngSwitchDefault>
      <ng-template *ngTemplateOutlet="zenodoCheck"></ng-template>
      <div *ngIf="action === SnapshotExporterAction.ORCID">
        <ng-template *ngTemplateOutlet="orcidCheck"></ng-template>
      </div>
      <mat-horizontal-stepper linear #stepper [selectedIndex]="version.frozen ? (version.doiURL ? 2 : 1) : 0">
        <mat-step label="Snapshot" state="snapshot" [completed]="version?.frozen">
          <ng-template *ngTemplateOutlet="doiBlurb"></ng-template>
          <div>
            <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px">
              <div fxFlex="60" *ngIf="doiRequested" class="confirmation">
                Are you sure you want to snapshot this version, making it uneditable? This cannot be undone.
              </div>
              <div fxFlex fxLayoutAlign="end" fxLayout="row">
                <button
                  [disabled]="!(hasZenodoToken$ | async)"
                  color="primary"
                  mat-flat-button
                  (click)="doiRequested = true"
                  *ngIf="!doiRequested"
                >
                  Request DOI
                </button>
                <button color="primary" mat-flat-button (click)="requestDOI()" *ngIf="doiRequested">Confirm</button>
                <button mat-button mat-dialog-close color="secondary">Cancel</button>
              </div>
            </div>
          </div>
        </mat-step>
        <mat-step label="DOI">
          <ng-template *ngTemplateOutlet="doiBlurb"></ng-template>
          <div fxFlex fxLayoutAlign="end" fxLayout="row">
            <button [disabled]="!(hasZenodoToken$ | async)" color="primary" mat-flat-button (click)="requestDOI()">Request DOI</button>
            <button mat-button mat-dialog-close color="secondary">Cancel</button>
          </div>
        </mat-step>
        <mat-step label="ORCID" *ngIf="action === SnapshotExporterAction.ORCID"> TBD </mat-step>
      </mat-horizontal-stepper>
    </div>
  </div>

  <ng-template #snapshotBlurb>
    <p>
      A snapshot freezes the workflow version, ensuring that the content of the workflow does not change if cited in publications.
      <b>Important note: once a snapshot is made, the workflow version becomes uneditable, apart from some metadata.</b>
    </p>
    <p>
      You can then use this snapshot to request a DOI or export to your ORCID profile.
      <b>Are you sure you want to snapshot this version?</b>
    </p>
  </ng-template>

  <ng-template #doiBlurb>
    <p>A Digital Object Identifier (DOI) allows a workflow version to be easily cited in publications. Whatâ€™s involved in the request:</p>
    <ol>
      <li>
        Before a DOI can be issued, a <b>snapshot</b> of the workflow version must be made to ensure that the content referenced by the DOI
        does not change. <b>Please note: a snapshot will make the workflow version uneditable, apart from some metadata.</b>
      </li>
      <li>
        Next, a DOI is requested, providing a unique identifier for this workflow version. The DOI identifier will be displayed in the
        snapshot column of the versions table.
      </li>
    </ol>
  </ng-template>

  <ng-template #zenodoCheck>
    <div *ngIf="!(hasZenodoToken$ | async)" class="account-link" fxLayout="row" fxLayoutGap="0.625rem;" fxLayoutAlign="end center">
      <div><mat-icon color="red">warning</mat-icon></div>
      <div>
        <div>
          To request a DOI, you must first link your Zenodo account in your Dockstore Linked Accounts section. After linking, come back to
          this screen and try again.
        </div>
        <div>
          <button class="link-action" mat-button (click)="linkAccount()">
            <mat-icon>link</mat-icon>
            Link account now
          </button>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #orcidCheck>
    <div *ngIf="!(hasOrcidToken$ | async)" class="account-link" fxLayout="row" fxLayoutGap="0.625rem;" fxLayoutAlign="end center">
      <div><mat-icon color="red">warning</mat-icon></div>
      <div>
        <div>
          To export a workflow to ORCID, you must first link your ORCID account in your Dockstore Linked Accounts section. After linking,
          come back to this screen and try again.
        </div>
        <div>
          <button class="link-action" mat-button (click)="linkAccount()">
            <mat-icon>link</mat-icon>
            Link account now
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</div>
