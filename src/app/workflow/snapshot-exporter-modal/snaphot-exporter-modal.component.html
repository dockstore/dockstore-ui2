<div>
  <h4 mat-dialog-title>
    {{ title }}: <span style="color: #3f51b5">Version {{ version.name }}</span>
  </h4>

  <div [ngSwitch]="action">
    <div *ngSwitchCase="SnapshotExporterAction.SNAPSHOT">
      <ng-template *ngTemplateOutlet="snapshotBlurb"></ng-template>
      <div>
        <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="10px">
          <button mat-button mat-dialog-close color="secondary">Cancel</button>
          <button color="primary" [disabled]="isAjaxing$ | async" mat-flat-button (click)="snapshot()">Snapshot</button>
        </div>
      </div>
    </div>

    <div *ngSwitchDefault>
      <div fxLayout="row" fxLayoutAlign="space-evenly center" style="padding-bottom: 54px">
        <app-exporter-step
          [stepState]="state.snapshot"
          matIcon="photo_camera"
          successText="Snapshot created"
          errorText="Snapshot error"
          defaultText="Snapshot"
        ></app-exporter-step>
        <app-exporter-step [stepState]="state.doi" aiIcon="ai-doi" successText="DOI created" errorText="DOI error" defaultText="DOI">
        </app-exporter-step>
        <app-exporter-step
          *ngIf="action === SnapshotExporterAction.ORCID"
          [stepState]="state.orcid"
          [faIcon]="faOrcid"
          successText="ORCID created"
          errorText="ORCID error"
          defaultText="ORCID"
        ></app-exporter-step>
      </div>

      <ng-template *ngTemplateOutlet="zenodoCheck"></ng-template>
      <div *ngIf="action === SnapshotExporterAction.ORCID">
        <ng-template *ngTemplateOutlet="orcidCheck"></ng-template>
      </div>

      <div *ngIf="action === SnapshotExporterAction.DOI">
        <ng-template *ngTemplateOutlet="doiBlurb"></ng-template>
      </div>
      <div *ngIf="action === SnapshotExporterAction.ORCID">
        <ng-template *ngTemplateOutlet="orcidBlurb"></ng-template>
      </div>

      <div mat-dialog-actions fxLayout="row" fxLayoutAlign="end">
        <div *ngIf="promptToConfirmSnapshot" class="confirmation-box" fxLayout="row" fxLayoutAlign="end" fxFlex="50" fxFlexOffset="50">
          <span class="confirmation-text"
            >Are you sure you want to snapshot this version, making it uneditable? This cannot be undone.</span
          >
        </div>
        <div fxLayoutAlign="end" fxLayout="row" fxFlex="50">
          <button mat-button mat-dialog-close color="secondary">Cancel</button>
          <button
            [disabled]="
              !(hasZenodoToken$ | async) || (action === SnapshotExporterAction.ORCID && !(hasOrcidToken$ | async)) || (isAjaxing$ | async)
            "
            color="primary"
            mat-flat-button
            (click)="export(false)"
            *ngIf="!promptToConfirmSnapshot"
          >
            {{ action === SnapshotExporterAction.DOI ? 'Request DOI' : 'Export' }}
          </button>
          <button color="primary" mat-flat-button [disabled]="isAjaxing$ | async" (click)="export(true)" *ngIf="promptToConfirmSnapshot">
            Confirm
          </button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #snapshotBlurb>
    <p>
      A snapshot freezes the workflow version, ensuring that the content of the workflow does not change if cited in publications.
      <b>Important note: once a snapshot is made, the workflow version becomes uneditable, apart from some metadata.</b>
    </p>
    <p>
      You can then use this snapshot to request a DOI or export to your ORCID profile.
      <b>Are you sure you want to snapshot this version?</b>
    </p>
  </ng-template>

  <ng-template #doiBlurb>
    <p>A Digital Object Identifier (DOI) allows a workflow version to be easily cited in publications. What’s involved in the request:</p>
    <ol>
      <li>
        Before a DOI can be issued, a <b>snapshot</b> of the workflow version must be made to ensure that the content referenced by the DOI
        does not change. <b>Please note: a snapshot will make the workflow version uneditable, apart from some metadata.</b>
      </li>
      <li>
        Next, a DOI is requested, providing a unique identifier for this workflow version. The DOI identifier will be displayed in the
        snapshot column of the versions table.
      </li>
    </ol>
  </ng-template>

  <ng-template #orcidBlurb>
    <p>
      Exporting to ORCID requires a Digital Object Identifier (DOI), which allows a workflow version to be easily cited in publications.
      What’s involved:
    </p>

    <ol>
      <li>
        Before a DOI can be issued, a snapshot of the workflow version must be made to ensure that the content referenced by the DOI does
        not change. Please note: a snapshot will make the workflow version uneditable, apart from some metadata.
      </li>
      <li>Next, a DOI is requested, providing a unique identifier for this workflow version.</li>
      <li>Lastly, the workflow will be exported to your ORCID profile.</li>
    </ol>
  </ng-template>

  <ng-template #zenodoCheck>
    <div *ngIf="!(hasZenodoToken$ | async)" class="account-link" fxLayout="row" fxLayoutGap="0.625rem;" fxLayoutAlign="end top">
      <div>
        <mat-icon style="color: #e34348">warning</mat-icon>
      </div>
      <div>
        <div>
          To request a DOI, you must first link your Zenodo account in your Dockstore Linked Accounts section. After linking, come back to
          this screen and try again.
        </div>
        <div>
          <button class="link-action" mat-button (click)="linkAccount()">
            <mat-icon>link</mat-icon>
            Link account now
          </button>
        </div>
      </div>
    </div>
  </ng-template>

  <ng-template #orcidCheck>
    <div *ngIf="!(hasOrcidToken$ | async)" class="account-link" fxLayout="row" fxLayoutGap="0.625rem;" fxLayoutAlign="end top">
      <div>
        <mat-icon style="color: #e34348">warning</mat-icon>
      </div>
      <div>
        <div>
          To export a workflow to ORCID, you must first link your ORCID account in your Dockstore Linked Accounts section. After linking,
          come back to this screen and try again.
          <button class="link-action" mat-button (click)="linkAccount()" style="color: #3f51b5; background-color: white">
            <mat-icon>link</mat-icon>
            Link account now
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</div>
