<!--
  ~    Copyright 2017 OICR
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->

<div class="p-3">
  <table
    aria-describedby="Version Information"
    mat-table
    [dataSource]="dataSource"
    class="w-100"
    matSort
    [matSortActive]="tool?.mode === DockstoreToolType.ModeEnum.HOSTED ? 'name' : 'last_built'"
    matSortDisableClear
    matSortDirection="desc"
  >
    <ng-container matColumnDef="name">
      <th
        scope="col"
        mat-header-cell
        *matHeaderCellDef
        mat-sort-header
        matTooltip="Tags from Docker repository: The selected tag will be used
          to populate the Info tab including 'Launch With'"
      >
        Version
        <a
          *ngIf="!publicPage"
          href="{{ Dockstore.DOCUMENTATION_URL }}/faq.html#what-is-a-default-version-of-a-tool-or-workflow"
          target="_blank"
          rel="noopener noreferrer"
          ><mat-icon>info</mat-icon></a
        >
      </th>
      <td mat-cell *matCellDef="let version">
        <span fxLayout="row" fxLayoutGap="0.5rem" fxLayoutAlign="start center">
          <span *ngIf="defaultVersion === version.name" class="label label-primary">Default</span>
          <!-- The href is so that the cursor changes to pointer on hover while not actually going anymore when clicked -->
          <a
            href="javascript:undefined"
            *ngIf="selectedTag?.name !== version?.name"
            matTooltip="Click to select version"
            (click)="setVersion(version)"
            >{{ version?.name }}</a
          >
          <span *ngIf="selectedTag?.name === version?.name">{{ version?.name }}</span>
        </span>
      </td>
    </ng-container>
    <ng-container matColumnDef="reference">
      <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header matTooltip="">Git Reference</th>
      <td mat-cell *matCellDef="let version">
        <div *ngIf="tool?.mode === DockstoreToolType.ModeEnum.HOSTED">
          {{ version?.versionEditor?.name }}
        </div>
        <div *ngIf="tool?.mode !== DockstoreToolType.ModeEnum.HOSTED">
          <i *ngIf="version.referenceType === 'BRANCH'" class="fa fa-code-fork" aria-hidden="true" title="Branch"></i>
          <i *ngIf="version.referenceType === 'TAG'" class="fa fa-tag" aria-hidden="true" title="Tag"></i>
          <span
            *ngIf="version.commitID && (version.commitID | commitUrl: tool?.providerUrl); else noCommitID"
            [matTooltip]="version.commitID ? 'Commit ID: ' + version.commitID : ''"
          >
            &nbsp;<a [href]="version.commitID | commitUrl: tool?.providerUrl">{{ version.reference || 'n/a' }}</a>
          </span>
          <ng-template #noCommitID
            ><span>{{ version.reference || 'n/a' }}</span></ng-template
          >
        </div>
      </td>
    </ng-container>
    <ng-container matColumnDef="last_built">
      <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header matTooltip="">Date Built</th>
      <td mat-cell *matCellDef="let version">
        {{ version.last_built | date: 'yyyy-MM-dd HH:mm' }}
      </td>
    </ng-container>
    <ng-container matColumnDef="valid">
      <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header matTooltip="">Valid</th>
      <td mat-cell *matCellDef="let version">
        <mat-icon *ngIf="version.valid">check</mat-icon>
      </td>
    </ng-container>
    <ng-container matColumnDef="hidden">
      <th scope="col" mat-header-cell *matHeaderCellDef mat-sort-header matTooltip="">Hidden</th>
      <td mat-cell *matCellDef="let version">
        <mat-icon *ngIf="version.hidden">check</mat-icon>
      </td>
    </ng-container>
    <ng-container matColumnDef="verified">
      <th
        scope="col"
        mat-header-cell
        *matHeaderCellDef
        matTooltip="A version is verified if it has been verified to work by a person/group."
      >
        Verified Platforms
      </th>
      <td mat-cell *matCellDef="let version">
        <span matTooltip="{{ getVerifiedSource(version.name) }}">{{ version?.sourceFiles | verifiedPlatforms }}</span>
      </td>
    </ng-container>
    <ng-container matColumnDef="actions">
      <th scope="col" mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let version">
        <app-view-container [version]="version"></app-view-container>
      </td>
    </ng-container>
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      [ngClass]="{ highlight: version.name === selectedTag.name }"
      mat-row
      *matRowDef="let row; columns: displayedColumns; let version"
    ></tr>
  </table>

  <button
    id="addTagButton"
    type="button"
    class="pull-right mr-1 my-3"
    *ngIf="!publicPage && isManualMode()"
    mat-flat-button
    color="primary"
    (click)="showAddTagModal()"
  >
    Add Tag
  </button>
</div>
