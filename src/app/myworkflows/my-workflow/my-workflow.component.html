<!--
  ~    Copyright 2017 OICR
  ~
  ~    Licensed under the Apache License, Version 2.0 (the "License");
  ~    you may not use this file except in compliance with the License.
  ~    You may obtain a copy of the License at
  ~
  ~        http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~    Unless required by applicable law or agreed to in writing, software
  ~    distributed under the License is distributed on an "AS IS" BASIS,
  ~    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~    See the License for the specific language governing permissions and
  ~    limitations under the License.
  -->
<app-header>
  <img src="../assets/images/dockstore/dockstore-workflows-green.png"> My Workflows
  <div class="pull-right refresh-all-holder">
    <button type="button" class="refresh-all-button btn btn-primary" (click)="refreshAllEntries()" [disabled]="refreshMessage !== null">
      Refresh All Workflows
    </button>
  </div>
</app-header>
<div class="container padding-top">
  <app-alert></app-alert>
  <div class="row" *ngIf="groupEntriesObject?.length == 0 || !groupEntriesObject">
    <div class="col-md-12">
      <div class="alert alert-info" role="alert">
        <p>
          <span class="glyphicon glyphicon-info-sign"></span>
          There are currently no workflows registered under this account, to add your first workflow, do one of the following:
        </p>
        <ul>
          <li>
            Press the 'Refresh All Workflows' button to create workflow stubs for all of your source control repositories. Browse to the workflow stubs and
            refresh/publish those that correspond to real workflows.
          </li>
          <li>
            Press the 'Register Workflow' button to manually add a workflow.
          </li>
        </ul>
        <div *ngIf="!hasGitHubToken">
          <a class="btn btn-block btn-social btn-github" (click)="link()">
            <span class="fa fa-github"></span> You do not have a linked GitHub token, click here to link a GitHub token
          </a>
        </div>
      </div>
    </div>
  </div>
  <!--Tool Content Page-->
  <div class="row">
    <div class="col-md-3 containers-rsb">
      <accordion [closeOthers]="oneAtATime">
        <accordion-group *ngFor="let orgObj of groupEntriesObject"  panelClass="containers-accordion"
          [isOpen]="orgObj?.isFirstOpen" [title]="orgObj?.sourceControl + '/' + orgObj?.organization">
          <div accordion-heading class="no-wrap">
            {{orgObj?.sourceControl + '/' + orgObj?.organization}}
          </div>
          <tabset [justified]="true">
            <tab heading="Published" [active]="orgObj.activeTab === 'published'">
              <div *ngFor="let workflowObj of orgObj?.published">
                <div class="panel-container-label" [ngClass]="{selected: workflow?.id === workflowObj?.id}">
                  <div style="cursor:pointer" class="no-wrap" title="{{workflowObj?.repository + (workflowObj?.workflowName ? '/' + workflowObj?.workflowName : '')}}"
                    (click)="selectEntry(workflowObj)">
                    {{workflowObj?.repository + (workflowObj?.workflowName ? '/' + workflowObj?.workflowName : '')}}
                  </div>
                </div>
              </div>
              <div *ngIf="orgObj?.published.length == 0" class="text-center">
                <p>No published workflows.</p>
              </div>
            </tab>
            <tab heading="Unpublished" [active]="orgObj.activeTab === 'unpublished'">
              <div *ngFor="let workflowObj of orgObj?.unpublished">
                <div class="panel-container-label" [ngClass]="{selected: workflow?.id === workflowObj?.id}">
                  <div style="cursor:pointer" class="no-wrap" title="{{workflowObj?.repository + (workflowObj?.workflowName ? '/' + workflowObj?.workflowName : '')}}"
                    (click)="selectEntry(workflowObj)">
                    {{workflowObj?.repository + (workflowObj?.workflowName ? '/' + workflowObj?.workflowName : '')}}
                  </div>
                </div>
              </div>
              <div *ngIf="orgObj?.unpublished.length == 0" class="text-center">
                <p>No unpublished workflows.</p>
              </div>
            </tab>
          </tabset>
          <span *ngIf="orgObj?.organization.startsWith('dockstore.org')">
            <app-refresh-workflow-organization class="pull-right" [organization]="orgObj?.organization"></app-refresh-workflow-organization>
          </span>
          <button type="button" class="glyphicon glyphicon-plus btn btn-primary btn-xs pull-right add-container-ns" (click)="setRegisterEntryModalInfo(orgObj?.organization + '/new_workflow'); showRegisterEntryModal()">
          </button>
        </accordion-group>
      </accordion>
      <div>
        <button type="button" class="btn btn-primary btn-sm pull-right" (click)="showRegisterEntryModal()" [disabled]="refreshMessage !== null">New Workflow</button>
      </div>
      <app-register-workflow-modal></app-register-workflow-modal>
    </div>
    <div *ngIf="workflow" class="col-md-9 containers-rsb">
      <app-workflow [isWorkflowPublic]="false"></app-workflow>
    </div>
  </div>
</div>
